<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.layout.*?>
<?import javafx.scene.control.*?>
<?import javafx.geometry.Insets?>

<StackPane xmlns:fx="http://javafx.com/fxml"
           fx:id="rootStack"
           fx:controller="examschd.controller.SchedulingController"
           stylesheets="@../../css/scheduling.css">

    <!-- ================= MAIN CONTENT ================= -->
    <AnchorPane fx:id="rootPane">

        <VBox spacing="18"
              alignment="TOP_CENTER"
              AnchorPane.topAnchor="14"
              AnchorPane.leftAnchor="20"
              AnchorPane.rightAnchor="20"
              AnchorPane.bottomAnchor="20">

            <!-- TITLE -->
            <Label text="Exam Scheduler â€” Dashboard"
                   styleClass="title"/>

            <!-- TOP BUTTONS -->
            <HBox spacing="15" alignment="CENTER">
                <Button text="Help"
                        onAction="#showHelp"
                        styleClass="blue-button"/>

                <Button fx:id="openFiltersBtn"
                        text="Filter Settings"
                        styleClass="blue-button"/>

                <Button fx:id="importBtn"
                        text="Import all data"
                        onAction="#openImportPopup"
                        styleClass="blue-button"/>

                <Button fx:id="generateBtn"
                        text="Generate Schedule"
                        onAction="#onGenerateSchedule"
                        styleClass="blue-button"/>
            </HBox>

            <!-- CARDS -->
            <HBox spacing="40" alignment="CENTER">

                <!-- STUDENT -->
                <VBox spacing="12" styleClass="card">
                    <Label text="Student Schedule" styleClass="card-title"/>
                    <TextField fx:id="studentSearchField"
                               promptText="Search by student ID..."
                               styleClass="search-field"/>
                    <ComboBox fx:id="studentCombo"
                              promptText="Select Student"
                              prefWidth="260"/>
                    <Button fx:id="showStudentBtn"
                            text="Show Schedule"
                            prefWidth="260"
                            styleClass="action-btn"/>
                </VBox>

                <!-- DATE RANGE -->
                <VBox spacing="12" styleClass="card">
                    <Label text="Exam Date Range" styleClass="card-title"/>

                    <HBox spacing="10">
                        <Label text="Start:"/>
                        <DatePicker fx:id="startDatePicker" prefWidth="180"/>
                    </HBox>

                    <HBox spacing="10">
                        <Label text="End:"/>
                        <DatePicker fx:id="endDatePicker" prefWidth="180"/>
                    </HBox>

                    <Button fx:id="applyDateRangeBtn"
                            text="Apply Date Range"
                            prefWidth="240"
                            styleClass="action-btn"
                            onAction="#applyDateRange"/>
                </VBox>

                <!-- CLASSROOM -->
                <VBox spacing="12" styleClass="card">
                    <Label text="Classroom Schedule" styleClass="card-title"/>
                    <TextField fx:id="classroomSearchField"
                               promptText="Search classroom name..."
                               styleClass="search-field"/>
                    <ComboBox fx:id="classroomCombo"
                              promptText="Select Classroom"
                              prefWidth="260"/>
                    <Button fx:id="showClassroomBtn"
                            text="Show Schedule"
                            prefWidth="260"
                            styleClass="action-btn"/>
                </VBox>

            </HBox>

            <!-- SCHEDULE -->
            <ScrollPane fx:id="scheduleScroll"
                        VBox.vgrow="ALWAYS"
                        fitToWidth="true"
                        fitToHeight="true"
                        hbarPolicy="AS_NEEDED"
                        vbarPolicy="AS_NEEDED"
                        pannable="true"
                        style="-fx-background-color: transparent;">

                <content>
                    <GridPane fx:id="scheduleGrid"
                              hgap="24"
                              vgap="16"
                              minHeight="520"
                              styleClass="schedule-table"/>
                </content>
            </ScrollPane>

            <!-- ðŸ”´ UNSCHEDULED ERROR BOX -->
            <VBox fx:id="unscheduledSection"
                  spacing="8"
                  visible="false"
                  managed="false"
                  style="
                      -fx-background-color:#FFEBEE;
                      -fx-border-color:#EF9A9A;
                      -fx-border-radius:10;
                      -fx-background-radius:10;
                      -fx-padding:16;
                  "/>

        </VBox>
    </AnchorPane>

    <!-- ================= HELP OVERLAY ================= -->
    <VBox fx:id="helpOverlay"
          visible="false"
          managed="false"
          alignment="TOP_CENTER"
          maxWidth="Infinity"
          maxHeight="Infinity"
          prefWidth="Infinity"
          prefHeight="Infinity"
          style="-fx-background-color: rgba(0,0,0,0.6);">

        <padding>
            <Insets top="80" right="0" bottom="0" left="0"/>
        </padding>

        <VBox spacing="20"
              maxWidth="480"
              style="
                  -fx-background-color: white;
                  -fx-padding: 32;
                  -fx-background-radius: 18;
                  -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.3), 24, 0, 0, 6);
              ">

            <!-- HEADER -->
            <HBox alignment="CENTER_LEFT"
                  spacing="10"
                  style="
                      -fx-padding: 0 0 12 0;
                      -fx-border-color:#E0E0E0;
                      -fx-border-width:0 0 1 0;
                  ">

                <Label text="How to Use Exam Scheduler"
                       style="-fx-font-size:20; -fx-font-weight:bold;"/>

                <Region HBox.hgrow="ALWAYS"/>

                <Button text="âœ•"
                        onAction="#closeHelp"
                        style="-fx-background-color: transparent; -fx-font-size:14;"/>
            </HBox>

            <!-- CONTENT -->
            <Label text="Follow these steps to create an exam timetable:"
                   style="-fx-text-fill:#555;"/>

            <Label text="â‘  Import Data" style="-fx-font-weight:bold;"/>
            <Label text="Upload CSV files for students, courses, classrooms and enrollments."
                   wrapText="true"/>

            <Label text="â‘¡ Select Date Range" style="-fx-font-weight:bold;"/>
            <Label text="Choose the exam period and click Apply Date Range."
                   wrapText="true"/>

            <Label text="â‘¢ Generate Schedule" style="-fx-font-weight:bold;"/>
            <Label text="Click Generate Schedule to create the exam calendar."
                   wrapText="true"/>

            <Separator/>

            <Label text="Tips" style="-fx-font-weight:bold;"/>
            <Label text="â€¢ Filters are optional.&#10;â€¢ Unscheduled courses are displayed if any conflicts occur."
                   wrapText="true"
                   style="-fx-text-fill:#555;"/>

            <Button fx:id="gotItBtn"
                text="Got it"
                onAction="#closeHelp"
                style="
                    -fx-background-color:#1976D2;
                    -fx-text-fill:white;
                    -fx-font-weight:bold;
                    -fx-background-radius:10;
                    -fx-padding:10 22;
                "/>
        </VBox>
    </VBox>

</StackPane>
